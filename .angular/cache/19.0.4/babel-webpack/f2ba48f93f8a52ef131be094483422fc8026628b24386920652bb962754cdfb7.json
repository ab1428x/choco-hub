{"ast":null,"code":"import { HttpClient } from '@angular/common/http';\nimport { BayPage } from 'src/app/models/bay-page';\nimport { PirateElement } from 'src/app/models/pirate-element';\nimport { environment } from 'src/environments/environment';\nimport * as cheerio from 'cheerio';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/common/http\";\nfunction BayComponent_table_6_tr_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function BayComponent_table_6_tr_11_Template_button_click_8_listener() {\n      const pirateEl_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.sendTorrentToPi(pirateEl_r4, \"nr\"));\n    });\n    i0.ɵɵtext(9, \"New Release\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function BayComponent_table_6_tr_11_Template_button_click_10_listener() {\n      const pirateEl_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.sendTorrentToPi(pirateEl_r4, \"c\"));\n    });\n    i0.ɵɵtext(11, \"Cereals\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function BayComponent_table_6_tr_11_Template_button_click_12_listener() {\n      const pirateEl_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.sendTorrentToPi(pirateEl_r4, \"da\"));\n    });\n    i0.ɵɵtext(13, \"Drop Area\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const pirateEl_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", pirateEl_r4.title, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", pirateEl_r4.seeds, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", pirateEl_r4.size, \" \");\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate1(\" \", pirateEl_r4.date, \" \");\n  }\n}\nfunction BayComponent_table_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 7)(1, \"th\");\n    i0.ɵɵtext(2, \"Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"th\");\n    i0.ɵɵtext(4, \"Seeds\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Size\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Save To...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Upload Date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, BayComponent_table_6_tr_11_Template, 16, 4, \"tr\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.pirateElements);\n  }\n}\nfunction BayComponent_nav_7_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 15)(1, \"a\", 16);\n    i0.ɵɵlistener(\"click\", function BayComponent_nav_7_li_2_Template_a_click_1_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.goToPage(ctx_r4.currentPage - 1));\n    });\n    i0.ɵɵtext(2, \"Previous\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction BayComponent_nav_7_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 17)(1, \"a\", 18);\n    i0.ɵɵlistener(\"click\", function BayComponent_nav_7_li_3_Template_a_click_1_listener() {\n      const page_r8 = i0.ɵɵrestoreView(_r7).$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.goToPage(page_r8.pageNumber));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const page_r8 = ctx.$implicit;\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", ctx_r4.currentPage == page_r8.pageNumber ? \"active\" : \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(page_r8.pageNumber);\n  }\n}\nfunction BayComponent_nav_7_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 15)(1, \"a\", 16);\n    i0.ɵɵlistener(\"click\", function BayComponent_nav_7_li_4_Template_a_click_1_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.goToPage(ctx_r4.currentPage - 1));\n    });\n    i0.ɵɵtext(2, \"Next\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction BayComponent_nav_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"nav\")(1, \"ul\", 12);\n    i0.ɵɵtemplate(2, BayComponent_nav_7_li_2_Template, 3, 0, \"li\", 13)(3, BayComponent_nav_7_li_3_Template, 3, 2, \"li\", 14)(4, BayComponent_nav_7_li_4_Template, 3, 0, \"li\", 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.currentPage > 1 && ctx_r4.pages.length > 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.subPages);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.pages.length > 0 && ctx_r4.currentPage < ctx_r4.pages[ctx_r4.pages.length - 1].pageNumber);\n  }\n}\nexport let BayComponent = /*#__PURE__*/(() => {\n  class BayComponent {\n    constructor(http, elementRef, router) {\n      this.http = http;\n      this.elementRef = elementRef;\n      this.router = router;\n      this.searchUrl = 'https://tpb.party';\n      this.piListenerUrl = environment.piListenerBayUrl;\n      this.proxyurl = environment.proxyurl;\n      this.pirateElements = [];\n      this.pages = [];\n      this.subPages = [];\n      this.currentPage = 1;\n    }\n    ngOnInit() {}\n    searchTorrents(searchInput) {\n      var tempSearchUrl = this.searchUrl + '/search/' + searchInput.value;\n      this.parseHtml(tempSearchUrl);\n    }\n    goToPage(pageNumber) {\n      var page = this.pages.find(x => x.pageNumber == pageNumber);\n      var tempSearchUrl = this.searchUrl + page.endUrl;\n      // this.currentPage = page.pageNumber;\n      this.parseHtml(tempSearchUrl);\n    }\n    parseHtml(searchUrl) {\n      // Setup header data for allowing angular to use proxy\n      var headers = new Headers();\n      headers.append('Content-Type', 'application/json');\n      headers.append('Accept', 'application/json');\n      headers.append('Access-Control-Allow-Origin', 'http://localhost:4200/bay');\n      headers.append('Access-Control-Allow-Credentials', 'true');\n      headers.append('GET', 'POST');\n      const requestOptions = {\n        headers: new Headers(headers)\n      };\n      var innerHTML = '';\n      this.pirateElements = [];\n      fetch(this.proxyurl + searchUrl, requestOptions).then(response => response.text()).then(contents => {\n        innerHTML = contents;\n        const $ = cheerio.load(contents);\n        const magnetLink = $('td').text();\n        alert(magnetLink);\n        return;\n        // Get initial div from response\n        var el = document.createElement('body');\n        el.innerHTML = innerHTML;\n        var divs = el.getElementsByTagName('div');\n        //  console.log(JSON.stringify(el.innerHTML));\n        // Get deeper div element content\n        //var contentDiv = this.getDiv(divs, 'content');\n        var mainContentDiv = this.getDiv(divs, 'main-content');\n        //   setTimeout(() => {\n        //     console.log('After 2 seconds:', Array.from(divs).map(div => div.innerHTML));\n        // }, 2000);\n        // console.log(JSON.stringify(divs));\n        // console.log(JSON.stringify(mainContentDiv?.innerHTML));\n        // Get table body content\n        var tableElement = this.getDiv(mainContentDiv.getElementsByTagName('table'), 'searchResult');\n        var tbodyElement = this.getDiv(tableElement.getElementsByTagName('tbody'), '');\n        console.log(tbodyElement.childNodes);\n        // Get data from table rows\n        Array.from(tbodyElement.childNodes).forEach(node => {\n          this.getTorrentRowData(node);\n        });\n        // Handle pagination\n        var lastNode = tbodyElement?.childNodes[tbodyElement.childNodes.length - 2];\n        this.createPaginationData(lastNode);\n      });\n    }\n    sendTorrentToPi(pirateEl, destination) {\n      var destinationUrl = this.piListenerUrl;\n      var magnetEncoded = encodeURIComponent(pirateEl.magnet);\n      var locationValue = 3;\n      switch (destination) {\n        case 'nr':\n          locationValue = 1;\n          break;\n        case 'c':\n          locationValue = 2;\n          break;\n        case 'da':\n          locationValue = 3;\n          break;\n      }\n      destinationUrl = destinationUrl + '/' + locationValue + '/';\n      destinationUrl = destinationUrl + magnetEncoded;\n      // Setup header data for allowing angular to use proxy\n      var headers = new Headers();\n      headers.append('Content-Type', 'application/json');\n      headers.append('Accept', 'application/json');\n      headers.append('Access-Control-Allow-Origin', 'http://localhost:4200/bay');\n      headers.append('Access-Control-Allow-Credentials', 'true');\n      headers.append('GET', 'POST');\n      const requestOptions = {\n        headers: new Headers(headers)\n      };\n      console.log(this.proxyurl + destinationUrl);\n      console.log(destination);\n      console.log(JSON.stringify(pirateEl));\n      fetch(this.proxyurl + destinationUrl, requestOptions).then(data => {\n        var temp = data.text().then(res => {\n          console.log(res);\n          if (res.includes(\"qt5ct\")) {\n            alert(\"Download Started on Chocolate Pi!\");\n          }\n        });\n      });\n    }\n    getDiv(htmlCollection, tag) {\n      var mainDiv = null;\n      Array.from(htmlCollection).forEach(function (div) {\n        if (div.id == tag) {\n          mainDiv = div;\n          console.log('tag - ' + tag);\n          console.log('getDiv - ' + div.id);\n        }\n      });\n      return mainDiv;\n    }\n    getTorrentRowData(node) {\n      // Get the child nodes with information and seed data\n      var infoNode = node.childNodes[3];\n      var seedNode = node.childNodes[5];\n      // Convert to HTMLElement\n      var infoElement = infoNode;\n      var seedElement = seedNode;\n      var magnetLink = \"\";\n      var title = \"\";\n      var description = \"\";\n      var size = \"\";\n      var seeds = \"\";\n      var date = \"\";\n      console.log('here');\n      console.log(JSON.stringify(node));\n      // console.log(JSON.stringify(infoElement.getAttribute('href')));\n      const tempDiv = document.createElement('div');\n      tempDiv.innerHTML = infoElement.innerHTML;\n      // Get the <a> element inside the temporary div\n      const anchor = tempDiv.querySelector('a');\n      if (anchor) {\n        const href = anchor.getAttribute('href'); // Extract the href attribute\n        console.log('Extracted href:', href);\n        magnetLink = href;\n      } else {\n        console.error('No <a> tag found inside the HTMLElement.');\n      }\n      // Extract needed data\n      if (infoElement != null) {\n        //  magnetLink = infoElement.getElementsByTagName('a')[1].href;\n        //title = infoElement.getElementsByTagName('a')[0].innerText;\n        title = 'placeholder';\n        // description = infoElement.getElementsByClassName('detDesc')[0].innerHTML;\n        description = '';\n      }\n      console.log(infoElement);\n      if (description != undefined && description != \"\") {\n        size = this.extractSize(description);\n        date = this.extractDate(description);\n      }\n      if (seedElement != null) {\n        seeds = seedElement.innerText;\n      }\n      // Create pirateElement and add to list\n      if (title.length > 0) {\n        var pirateEntry = new PirateElement();\n        pirateEntry.magnet = magnetLink;\n        pirateEntry.title = title;\n        pirateEntry.seeds = seeds;\n        pirateEntry.size = size;\n        pirateEntry.date = date;\n        this.pirateElements.push(pirateEntry);\n      }\n    }\n    createPaginationData(lastNode) {\n      // Get the td element\n      var searchTd = lastNode.getElementsByTagName('td')[0];\n      // Clear previous data\n      this.pages = [];\n      // Loop entries for links and current page\n      if (searchTd != null) {\n        Array.from(searchTd.childNodes).forEach(node => {\n          // B is the current page\n          if (node.nodeName == \"B\") this.currentPage = Number(node.innerText);\n          // A is a link to another page\n          if (node.nodeName == \"A\") {\n            var newPage = new BayPage();\n            var outerHtml = node.outerHTML;\n            var urlEnd = outerHtml.split('\"')[1];\n            // Create and add new page to list\n            newPage.pageNumber = Number(node.innerText);\n            newPage.endUrl = urlEnd;\n            this.pages.push(newPage);\n          }\n        });\n      }\n      // Remove duplicate pages\n      this.pages = this.pages.filter(x => x.pageNumber);\n      this.createSubPages();\n    }\n    createSubPages() {\n      this.subPages = [];\n      // Get 2 previous pages\n      var leftStartIndex = this.currentPage > 2 ? this.currentPage - 1 - 2 : 0;\n      var leftEndLength = this.currentPage > 2 ? leftStartIndex + 2 : this.currentPage == 1 ? 0 : 1;\n      // Get 2 next pages\n      var rightStartIndex = this.currentPage - 1;\n      var rightEndLength = 2;\n      var leftHandPages = this.pages.slice(leftStartIndex, leftEndLength);\n      var rightHandPages = this.pages.slice(rightStartIndex, rightStartIndex + 2);\n      // Add mock element as the active page\n      var currentPageModel = new BayPage();\n      currentPageModel.pageNumber = this.currentPage;\n      this.subPages.push(...leftHandPages);\n      this.subPages.push(currentPageModel);\n      this.subPages.push(...rightHandPages);\n    }\n    extractSize(text) {\n      var newText = '';\n      newText = text.split('Size ')[1];\n      newText = newText.replace(\"&nbsp;\", ' ');\n      newText = newText.split(',')[0];\n      return newText;\n    }\n    extractDate(text) {\n      var newText = '';\n      newText = text.split('Uploaded ')[1];\n      newText = newText.replace(\"&nbsp;\", '-');\n      newText = newText.split(',')[0];\n      return newText;\n    }\n    static {\n      this.ɵfac = function BayComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || BayComponent)(i0.ɵɵdirectiveInject(HttpClient), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: BayComponent,\n        selectors: [[\"app-bay\"]],\n        standalone: false,\n        decls: 8,\n        vars: 2,\n        consts: [[\"searchInput\", \"\"], [1, \"input-group\", \"search-div\"], [\"type\", \"search\", \"placeholder\", \"Search\", \"aria-label\", \"Search\", \"aria-describedby\", \"search-addon\", 1, \"form-control\", \"rounded\", \"search-box\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-primary\", \"search-btn\", 3, \"click\"], [1, \"table-responsive\"], [\"class\", \"table results-table\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"table\", \"results-table\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 2, \"margin-right\", \"3px\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 2, \"margin-right\", \"3px\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-warning\", 3, \"click\"], [1, \"pagination\"], [\"class\", \"page-item\", 4, \"ngIf\"], [\"class\", \"page-item\", 3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [1, \"page-item\"], [\"href\", \"#\", 1, \"page-link\", 3, \"click\"], [1, \"page-item\", 3, \"ngClass\"], [1, \"page-link\", 3, \"click\"]],\n        template: function BayComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1);\n            i0.ɵɵelement(1, \"input\", 2, 0);\n            i0.ɵɵelementStart(3, \"button\", 3);\n            i0.ɵɵlistener(\"click\", function BayComponent_Template_button_click_3_listener() {\n              i0.ɵɵrestoreView(_r1);\n              const searchInput_r2 = i0.ɵɵreference(2);\n              return i0.ɵɵresetView(ctx.searchTorrents(searchInput_r2));\n            });\n            i0.ɵɵtext(4, \"search\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(5, \"div\", 4);\n            i0.ɵɵtemplate(6, BayComponent_table_6_Template, 12, 1, \"table\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(7, BayComponent_nav_7_Template, 5, 3, \"nav\", 6);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngIf\", ctx.pirateElements.length > 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.pages.length > 1);\n          }\n        },\n        dependencies: [i2.NgClass, i2.NgForOf, i2.NgIf],\n        styles: [\".search-btn[_ngcontent-%COMP%]{margin-left:5px}.search-div[_ngcontent-%COMP%]{width:50%}.results-table[_ngcontent-%COMP%]{color:#fff}.results-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:0}.results-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .results-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{color:#dd5}@media (max-width: 767.98px){button[_ngcontent-%COMP%]{width:84px}.input-group.search-div[_ngcontent-%COMP%]{display:inline-block;width:100%}.search-box[_ngcontent-%COMP%]{width:70%;float:left}.search-btn[_ngcontent-%COMP%]{float:right}}\"]\n      });\n    }\n  }\n  return BayComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}